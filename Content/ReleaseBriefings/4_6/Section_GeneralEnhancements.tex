%==========================================================================

\begin{frame}[fragile]

  {\Huge General Enhancements}

  \vspace{10pt}

\end{frame}

%==========================================================================

% Examples

% note: always keep the [fragile] for your frames!

%\begin{frame}[fragile]{Example list}
%  \begin{itemize}
%      \item Item 1
%      \item Item 2 with some \texttt{code}
%      \begin{itemize}
%        \item Sub-item 2.1
%        \item Sub-item 2.2
%      \end{itemize}
%  \end{itemize}
%\end{frame}

%\begin{frame}[fragile]{Example code}
%    \begin{code}[keywords={std}]
%        #include <iostream>
%        
%        int main() {
%            std::cout << "hello world\n";
%        }
%    \end{code}
%\end{frame}

%\begin{frame}[fragile]{Example table}
%    \begin{center}
%        \begin{tabular}{l|l}
%            a & b \\\hline
%            c & d
%        \end{tabular}
%    \end{center}
%\end{frame}

%==========================================================================

\begin{frame}[fragile]{Fix a warning from kokkos\_check}
 \begin{itemize}
    \item \texttt{kokkos\_check}: Check at configure time that Kokkos was built with the requested backends and target architectures. Throws a fatal error otherwise.
    \item Fix a warning when a user calls the cmake function \texttt{kokkos\_check} from a \texttt{<PackageName>Config.cmake} file
    {\tiny \begin{verbatim}
CMake Warning (dev) at /usr/share/cmake-3.22/Modules/FindPackageHandleStandardArgs.cmake:438 (message):
  The package name passed to `find_package_handle_standard_args`
  (Kokkos_DEVICES) does not match the name of the calling package (SomePackage).
  This can lead to problems in calling code that expects `find_package`
  result variables (e.g., `_FOUND`) to follow a certain pattern.
Call Stack (most recent call first):
  ... /kokkos/lib/cmake/Kokkos/KokkosConfigCommon.cmake:110 (find_package_handle_standard_args)
  ...
This warning is for project developers.  Use -Wno-dev to suppress it.
    \end{verbatim}}
 \end{itemize}
\end{frame}

\begin{frame}[fragile]{\texttt{inclusive\_scan} performance improvements}
  With the Cuda and HIP backends, \texttt{Kokkos::Experimental::inclusive\_scan} now calls the vendor versions in Thrust
  \begin{itemize}
     \item The vendor versions are faster than the \texttt{Kokkos::parallel\_scan}-based default implementation
     \item Thrust requires \texttt{Kokkos\_ENABLE\_ROCTHRUST} to be \texttt{ON} (which is the default)
  \end{itemize}
\end{frame}

\begin{frame}[fragile]{Reduce tooling interface overhead}
  Reduced the overhead of Kokkos tools related checks
  \begin{itemize}
      \item Store the information whether Kokkos tools are enabled after each modification to the tools' callbacks
      \item Previously, this value was recomputed for every event (\texttt{parallel\_for}, \texttt{fence}, etc.)
      \item Most noticeable in small serial kernels (around 100 elements)
  \end{itemize}
\end{frame}

%==========================================================================
\begin{frame}[fragile]{SIMD reductions and compound assignments}
  Added reductions and remaining compound assignments to Kokkos SIMD

  \begin{itemize}
    \item \texttt{basic\_simd\& operator/=(basic\_simd\&, U\&\&)}
    \item \texttt{basic\_simd\& operator>>=(basic\_simd\&, U\&\&)}
    \item \texttt{basic\_simd\& operator<<=(basic\_simd\&, U\&\&)}
  \end{itemize}

  \vspace{5pt}
  
  \begin{itemize}
    \item \texttt{T reduce\_min(const basic\_simd\& x)}
    \item \texttt{T reduce\_max(const basic\_simd\& x)}
    \item \texttt{T reduce(const basic\_simd\& x, const mask\_type\& mask, T identity\_element, BinaryOperation binary\_op)}
      \begin{itemize}
        \item Supported binary operations are: std::plus, std::multiplies, std::bit\_and, std::bit\_or and std::bit\_xor
        \item std::plus is used if binary op is not specified
      \end{itemize}
  \end{itemize}

\end{frame}
%==========================================================================
\begin{frame}[fragile]{Avoid storing a view in RandomAccessIterator}

  In Kokkos 4.5, \texttt{Kokkos::sort} was changed to use raw pointers on host
  \begin{itemize}
    \item Resolves performance issue of \texttt{Kokkos::sort} on host when using \texttt{RandomAccessIterator}
    \item Caused by reference counting and view access in \texttt{RandomAccessIterator}
  \end{itemize}

  \vspace{10pt}
  
  Following revisions are made in Kokkos 4.6
  \begin{itemize} 
    \item Reverted previous changes in \texttt{Kokkos::sort}
    \item Replaced views with raw pointers in \texttt{RandomAccessIterator} instead
    \begin{itemize}
      \item Prevents \texttt{RandomAccessIterator} from participating in view reference counting
    \end{itemize}
  \end{itemize}

\end{frame}
%==========================================================================
\begin{frame}[fragile]{Print support for system allocated memory}
  \texttt{print\_configuration} outputs if system allocated memory is accessible on GPU

  \vspace{5pt}

  \begin{code}
    Device Execution Space:
      KOKKOS_ENABLE_HIP: yes
    HIP Options:
      KOKKOS_ENABLE_HIP_RELOCATABLE_DEVICE_CODE: no
    
    Runtime Configuration:
      ...

    Kokkos::HIP[ 0 ] gcnArch gfx942:sramecc+:xnack+, Total Global Memory: 94.08 GiB,
    Shared Memory per Block: 64 KiB,
    APU or dGPU: APU, Is Large Bar: 1, Supports Managed Memory: 1,
    XNACK environment variable set: yes
    Kernel reports HMM module via `CONFIG_HMM_MIRROR=y` in `/boot/config`: yes
    Architecture capable of accessing system allocated memory: 1,
    System allows accessing system allocated memory on GPU: 1,
    Wavefront Size: 64 : Selected
  \end{code}
    
\end{frame}
%==========================================================================
